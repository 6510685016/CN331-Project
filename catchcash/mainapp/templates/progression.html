<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progression Nodes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css?v={{ STATIC_VERSION }}">

</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Progression Nodes</h2>
        <div id="graph-container" style="position: relative; height: 800px; border: 1px solid #ccc;"></div>
    </div>

    <script>
    const walletCount = {{ wallet_count|safe }};
    </script>
    <script>
        // Node data
        
        const nodes = [
            { id: 1, name: "Start", x: 30, y: 250, unlocked: false, condition: () => walletCount > 1 },
            { id: 2, name: "Node 2", x: 300, y: 150, unlocked: false, condition: () => nodes.find(n => n.id === 1).unlocked && walletCount > 2 },
            { id: 3, name: "Node 3", x: 200, y: 500, unlocked: false, condition: () => nodes.find(n => n.id === 1).unlocked && walletCount > 3 },
            { id: 4, name: "Node 4", x: 700, y: 100, unlocked: false, condition: () => nodes.find(n => n.id === 6).unlocked },
            { id: 5, name: "Node 5", x: 900, y: 350, unlocked: false, condition: () => nodes.find(n => n.id === 4).unlocked && nodes.find(n => n.id === 6).unlocked },
            { id: 6, name: "Node 6", x: 700, y: 500, unlocked: false, condition: () => nodes.find(n => n.id === 3).unlocked },
        ];
    
        // Connections between nodes
        const connections = [
            { from: 1, to: 2 },
            { from: 1, to: 3 },
            { from: 2, to: 4 },
            { from: 3, to: 6 },
            { from: 4, to: 5 },
            { from: 6, to: 5 },
        ];
    
        const container = document.getElementById("graph-container");
        const NODE_RADIUS = 50;
    
        // Create nodes
        nodes.forEach(node => {
            const div = document.createElement("div");
            div.className = `node ${node.unlocked ? "unlocked" : "locked"}`;
            div.style.left = `${node.x}px`;
            div.style.top = `${node.y}px`;
            div.textContent = node.name;
            container.appendChild(div);
        });
    
        // Draw connections
        connections.forEach(conn => {
            const fromNode = nodes.find(n => n.id === conn.from);
            const toNode = nodes.find(n => n.id === conn.to);
    
            if (fromNode && toNode) {
                const line = document.createElement("div");
                line.className = "connection";
    
                const x1 = fromNode.x + NODE_RADIUS;
                const y1 = fromNode.y + NODE_RADIUS;
                const x2 = toNode.x + NODE_RADIUS;
                const y2 = toNode.y + NODE_RADIUS;
    
                const angle = Math.atan2(y2 - y1, x2 - x1);
    
                const adjustedX1 = x1 + Math.cos(angle) * NODE_RADIUS;
                const adjustedY1 = y1 + Math.sin(angle) * NODE_RADIUS;
                const adjustedX2 = x2 - Math.cos(angle) * NODE_RADIUS;
                const adjustedY2 = y2 - Math.sin(angle) * NODE_RADIUS;
    
                const length = Math.sqrt((adjustedX2 - adjustedX1) ** 2 + (adjustedY2 - adjustedY1) ** 2);
    
                line.style.width = `${length}px`;
                line.style.left = `${adjustedX1}px`;
                line.style.top = `${adjustedY1}px`;
                line.style.transform = `rotate(${Math.atan2(adjustedY2 - adjustedY1, adjustedX2 - adjustedX1) * (180 / Math.PI)}deg)`;
    
                container.appendChild(line);
            }
        });
        // Update nodes' status based on conditions
        function updateNodes() {
            nodes.forEach(node => {
                if (!node.unlocked && node.condition && node.condition()) {
                    node.unlocked = true;
                    const nodeElement = document.querySelectorAll('.node')[node.id - 1];
                    if (nodeElement) {
                        nodeElement.classList.remove("locked");
                        nodeElement.classList.add("unlocked");
                    }
                }
            });
        }
    
        // Call updateNodes initially
        updateNodes();
    </script>
    